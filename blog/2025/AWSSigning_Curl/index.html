<!DOCTYPE html> <html lang=""> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Signing AWS Requests with Curl | Nicholas A. Phair </title> <meta name="author" content="Nicholas A. Phair"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%94%A5&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="/blog/2025/AWSSigning_Curl/"> <script src="/assets/js/theme.js"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Nicholas</span> A. Phair </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Signing AWS Requests with Curl</h1> <p class="post-meta"> Created in February 14, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/aws"> <i class="fa-solid fa-hashtag fa-sm"></i> AWS</a>   <a href="/blog/tag/curl"> <i class="fa-solid fa-hashtag fa-sm"></i> curl</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>All requests to AWS APIs must be signed using <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_sigv.html" rel="external nofollow noopener" target="_blank">AWS Signature Version 4 (SigV4)</a>. While the <a href="https://aws.amazon.com/developer/" rel="external nofollow noopener" target="_blank">AWS SDK libraries</a> and the <a href="https://github.com/DavidMuller/aws-requests-auth" rel="external nofollow noopener" target="_blank">AWS CLI</a> will handle this for you, external HTTP client libraries are on their own to support the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_sigv-create-signed-request.html" rel="external nofollow noopener" target="_blank">SigV4 signing process</a>.</p> <p>This matters if you have built an application using API Gateway and IAM authorization. Client requests, whether it be from a mobile application or testing script, need to be signed. Fortunately, the open-source community has contributed support for SigV4 in many popular HTTP libraries (e.g., <a href="https://github.com/DavidMuller/aws-requests-auth" rel="external nofollow noopener" target="_blank">Python’s Requests</a>, <a href="https://github.com/nicholasphair/aws_signature_v4_interceptor" rel="external nofollow noopener" target="_blank">Dart’s Dio</a>). Notably, the command line tool, <a href="https://github.com/curl/curl" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">curl</code></a>, has native support for AWS signing.</p> <p>The curl incantation is tricky enough that I have to google and fuss about it a bit to get it right. Here are some common ways of signing your requests with curl.</p> <p>If you are still using long-term access keys this will do:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="se">\</span>
  <span class="nt">--request</span> POST <span class="se">\</span>
  <span class="nt">--user</span> <span class="s2">"</span><span class="nv">$AWS_ACCESS_KEY</span><span class="s2">:</span><span class="nv">$AWS_SECRET_ACCESS_KEY</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--aws-sigv4</span> <span class="s2">"aws:amz:us-east-1:execute-api"</span> <span class="se">\</span>
  <span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>
</code></pre></div></div> <p>Of course, that approach is <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" rel="external nofollow noopener" target="_blank">no longer recommended</a>, and you should use short-lived credentials. With short-lived credentials you’ll have to include session information with your temporary access and secret key.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="se">\</span>
  <span class="nt">--request</span> POST <span class="se">\</span>
  <span class="nt">--user</span> <span class="s2">"</span><span class="nv">$AWS_ACCESS_KEY</span><span class="s2">:</span><span class="nv">$AWS_SECRET_ACCESS_KEY</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--aws-sigv4</span> <span class="s2">"aws:amz:us-east-1:execute-api"</span> <span class="se">\</span>
  <span class="nt">--header</span> <span class="s2">"x-amz-security-token: </span><span class="nv">$AWS_SESSION_TOKEN</span><span class="s2">"</span> <span class="se">\</span>
  <span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY</code>, <code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code>, and <code class="language-plaintext highlighter-rouge">AWS_SESSION_TOKEN</code> are probably not in your environment. If you have programatic access (via the CLI) to the AWS account the API is in, and your permissions are sufficient, you can use the values in cached by the AWS CLI cache after a login.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-lt</span> ~/.aws/cli/cache
</code></pre></div></div> <p>You will likely want the most recent file there.</p> <p>Better still is to use the CLI itself to get at those values.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure export-credentials <span class="nt">--format</span> process
</code></pre></div></div> <p>You can parse the json output of that command and automate the steps needed to run your curl. Note, the aws CLI won’t respect the <code class="language-plaintext highlighter-rouge">--query</code> option for the <code class="language-plaintext highlighter-rouge">export-credentials</code> command - I presume to avoid piping sensitive data to external processes - so you will have to parse the output with a tool you trust. I use <code class="language-plaintext highlighter-rouge">jq</code> in the command below.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl 
 <span class="nt">--request</span> POST <span class="se">\</span>
 <span class="nt">--aws-sigv4</span> <span class="s2">"aws:amz:us-east-1:execute-api"</span> <span class="se">\</span>
 <span class="nt">--user</span> <span class="s2">"</span><span class="si">$(</span>aws configure export-credentials <span class="nt">--format</span> process | jq <span class="nt">-r</span> .AccessKeyId<span class="si">)</span><span class="s2">:</span><span class="si">$(</span>aws configure export-credentials <span class="nt">--format</span> process | jq <span class="nt">-r</span> .SecretAccessKey<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
 <span class="nt">--header</span> <span class="s2">"x-amz-security-token: </span><span class="si">$(</span>aws configure export-credentials <span class="nt">--format</span> process | jq <span class="nt">-r</span> .SessionToken<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
 <span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
 <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span>
</code></pre></div></div> <p>And there you have it. Not the fastest but I think <a href="https://youtu.be/mGP-CvjqmXA?si=O21Tp14A-5iduuZm" rel="external nofollow noopener" target="_blank">it looks pretty good</a>.</p> </div> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Nicholas A. Phair. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> </body> </html>